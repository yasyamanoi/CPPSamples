<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<link href="css/main.css" rel="stylesheet" type="text/css">
<title>C++サンプル集</title>
</head>
<body>
<!-- 全体コンテナ　-->
<div id="container">
<header>
<div id="title_words">C++サンプル集</div>
</header>
<!-- コンテンツ　-->
<div id="contents">
<h1>【第1部】C言語（K＆R移植）編</h1>
<h1 class="pagetitle">０００９．文字列の長さを調べる</h1>
<div class="box1_title">CPPファイルに記述</div>
<div class="box1">
<pre>
#include &lt;iostream>
#include &lt;cstdio>
using namespace std;

/*
strlen: sの長さを返す
*/
int strlen(char s[]) {
    int i{};
    while (s[i] != '\0') {
        ++i;
    }
    return i;
}

/*
文字列の長さを調べる
*/
int main()
{
    char str1[] = "hello";
    char str2[] = "abcdefgh";

    cout &lt;&lt; str1 &lt;&lt; "は" &lt;&lt; strlen(str1) &lt;&lt; "文字" &lt;&lt; endl;
    cout &lt;&lt; str2 &lt;&lt; "は" &lt;&lt; strlen(str2) &lt;&lt; "文字" &lt;&lt; endl;

    return 0;
}
</pre>
</div>
<div class="box1_title">出力</div>
<div class="box1">
<pre>
helloは5文字
abcdefghは8文字
</pre>
</div>
<h4>サンプル説明</h4>
　このサンプルは<b>C言語</b>の標準ライブラリにも含まれる<b>strlen()関数</b>を説明したものです<b>C/C++</b>では<b>文字列の終端</b>は<b>'\0'</b>つまり<b> 0 </b>という値が入ってます（ほかの言語では必ずしもそうではありません）。この特性を利用して、<b>文字列の長さ</b>を検証します。<br />
　しかし現在では、<b>strlen()関数</b>は、引数が1つではなく2つのバージョン
<div class="box1">
<pre>
size_t strnlen(const char *str,size_t numberOfElements);  
</pre>
</div>
　を使うことが奨励されています。つまり<b>永遠に'\0'が来なかったらどうなるか</b>ということです。いずれどこかで破たんして<b>スタックオーバーフロー</b>を起こす可能性があります。<b>スタックオーバーフロー</b>は処理系によっては思わぬセキュリティ的な穴が生じます。ハッキングの温床にもなりかねませんので、もし<b>C言語のstrnlen()</b>を使う場合は、セキュリティ強化バージョンを使用しましょう。<br />
　さて、この処理を<b>string</b>を使って書くと、以下のようになります。
<div class="box1_title">CPPファイルに記述</div>
<div class="box1">
<pre>
#include &lt;iostream>
#include &lt;string>
using namespace std;

/*
文字列の長さを調べるテスト
*/
int main()
{
    string str1= "hello";
    string str2 = "abcdefgh";

    cout &lt;&lt; str1 &lt;&lt; "は" &lt;&lt; str1.size() &lt;&lt; "文字" &lt;&lt; endl;
    cout &lt;&lt; str2 &lt;&lt; "は" &lt;&lt; str2.size() &lt;&lt; "文字" &lt;&lt; endl;

    return 0;
}
</pre>
</div>
　<b>string</b>を使うと、もう<b>strnlen()関数</b>は必要ありません。大きすぎる文字列があっても、<b>string</b>は内部でメモリを取得します。<br />
　もしメモリを取得できなかったら、<b>string</b>は<b>例外</b>を発生させます。つまり内部でエラー処理が行われます。<br />
　このように便利な<b>string</b>ですが、この<b>便利だ</b>ということがわかるのは<b>strnlen()関数</b>があってこそのことです。<br />
　ですから<b>strnlen()関数を一度書いてみる</b>というのは重要なことです。
<h4>K&Rでの記述</h4>
　元になったのは<b>第2章:データ型・演算子・式</b>に記述されています。<b>定数</b>の説明のところです。
</div>
<!-- /コンテンツ　-->
<hr>
<!-- フッタ　-->
<footer>
<table>
<tr>
<td><a href="00_08.html">前へ</a></td>
<td><a href="index.html">目次</a></td>
<td><a href="00_10.html">次へ</a></td>
</tr>
</table>
</footer>
<!-- /フッタ　-->
</div>
<!-- /全体コンテナ　-->
</body>
</html>
